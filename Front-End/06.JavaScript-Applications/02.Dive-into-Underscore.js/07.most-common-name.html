<!DOCTYPE html>
<html>

<head>
    <title>Dive into Underscore.js</title>
    <script src="scripts/underscore.js"></script>
</head>

<body>
    <script>
        /**
         * By an array of people find the most common first and last name.
         */
        (function () {
            'use strict';

            function Person(fname, lname) {
                this.fname = fname;
                this.lname = lname;
            };

            var people = [
                new Person('Svetlin', 'Nakov'),
                new Person('Svetlin', 'Ivanov'),
                new Person('Nikolay', 'Kostov'),
                new Person('Nikolay', 'Vasilev'),
                new Person('Nikolay', 'Ivanov'),
                new Person('Nikolay', 'Donev'),
                new Person('Ivaylo', 'Kenov'),
                new Person('Ivaylo', 'Hristov'),
                new Person('Ivaylo', 'Ivanov'),
                new Person('Doncho', 'Minkov')
            ];

            /**
             * Returns the most common property value in a list of objects.
             */
            function getMostCommonProperty(objects, prop) {
                var groups = _.groupBy(objects, prop);
                return _.max(groups, function (gr) {
                    return gr.length
                })[0][prop];
            }

            // function getMostCommonProperty2(objects, prop) {
            //     var groupsByPropCount = _.countBy(objects, prop);
            //     var pairs = _.pairs(groupsByPropCount);
            //     return _.max(pairs, _.last)[0];
            // }
            //
            // function getMostCommonProperty3(objects, prop) {
            //     var groupsByPropCount = _.countBy(objects, prop);
            //     var maxCount = _.max(groupsByPropCount);
            //     return _.invert(groupsByPropCount)[maxCount];
            // }

            var topFirstName = getMostCommonProperty(people, 'fname');
            var topLastName = getMostCommonProperty(people, 'lname');

            console.log('Most common first name is: ' + topFirstName);
            console.log('Most common last name is: ' + topLastName);

        }());
    </script>
</body>

</html>
