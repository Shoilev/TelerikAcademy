<!DOCTYPE html>
<html>

<head>
    <title>Bulls and Cows</title>
    <link rel="stylesheet" type="text/css" href="style.css">
    <script src="scripts/underscore.js"></script>
</head>

<body>
    <div id="container">
        <ul id="rules">
            <li>Guess a number with 4 unique digits from 1 through 9:</li>
            <li>*bulls - digits in the right place</li>
            <li>*cows - correct digits, but in the wrong place</li>
        </ul>
        <input type="text" id="input" autofocus="autofocus" placeholder="Type your guess here..." />
        <ul id="output"></ul>
        <input type="text" id="submit" placeholder="Enter your name here..." />
        <div id="scoreBoard">
            <p>Top scores:</p>
            <ul id="scoreList"></ul>
        </div>
    </div>
    <script src="scripts/uiManager.js"></script>
    <script>
        /**
         * Create a simple number guessing game (bulls and cows).
         * Implement a high-score list and save it in localStorage.
         */
        (function (ui) {
            'use strict';

            var SIZE = 4,
                digits = "123456789",
                secret = _.sample(digits, SIZE),
                countGuesses = 0,
                gameEnded = false;

            console.log(secret.join(''));
            ui.attachInputHandler(onGuess);

            function onGuess(evt) {
                if (gameEnded) return;
                var guess = this.value;
                if (_.intersection(guess, digits).length !== SIZE)
                    return ui.print('Invalid guess, try again.');

                countGuesses++;
                var bulls = _.reduce(_.zip(guess, secret), function (count, p) {
                    return p[0] == p[1] ? count + 1 : count;
                }, 0);

                if (bulls == SIZE)
                    return endGame(guess);

                var cows = _.intersection(guess, secret).length - bulls;
                ui.print(guess + ': ' + bulls + ' bulls, ' + cows + ' cows');
            }

            function endGame(guess) {
                ui.print(guess + ': Correct, you guessed it from ' + countGuesses + ' guesses!');
                ui.print('Please enter your nickname in the input box...')
                gameEnded = true;
                ui.showSubmitForm(countGuesses);
            }

        }(uiManager));
    </script>
</body>

</html>
