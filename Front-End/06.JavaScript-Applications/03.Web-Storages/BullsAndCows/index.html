<!DOCTYPE html>
<html>

<head>
    <title>Bulls and Cows</title>
    <link rel="stylesheet" type="text/css" href="style.css">
    <script src="scripts/underscore.js"></script>
</head>

<body>
    <div id="container">
        <input type="text" id="input" autofocus="autofocus" placeholder="Type your guess here..." />
        <ul id="output"></ul>
    </div>
    <script>
        /**
         * Create a simple number guessing game (bulls and cows).
         * When the game ends save the player nickname inside the localStorage.
         * Implement a high-score list
         */
        (function () {
            'use strict';

            var SIZE = 4,
                digits = "123456789",
                secret = _.sample(digits, SIZE),
                countGuesses = 0,
                output = document.getElementById('output');

            window.addEventListener("load", main, false);

            function main() {
                print('Guess a number with ' + SIZE + ' unique digits from 1 through 9:');
                print('*bulls - digits in the right place');
                print('*cows - correct digits, but in the wrong place');

                var inputText = document.getElementById('input');
                inputText.addEventListener('change', onGuess, false);
                console.log(secret.join(''));
            }

            function onGuess() {
                var guess = this.value;
                if (_.intersection(guess, digits).length !== SIZE)
                    return print('Invalid guess, try again.');

                countGuesses++;
                var bulls = _.reduce(_.zip(guess, secret), function (b, pair) {
                    return pair[0] == pair[1] ? b + 1 : b;
                }, 0);

                if (bulls == SIZE)
                    return print(guess + ': Correct, you guessed it from ' + countGuesses + ' guesses!');

                var cows = _.intersection(guess, secret).length - bulls;
                print(guess + ': ' + bulls + ' bull(s), ' + cows + ' cow(s).');
            }

            function print(text) {
                output.innerHTML += '<li>' + text + '</li>'
            }

        }());
    </script>
</body>

</html>
