<!DOCTYPE html>
<html>

<head>
    <title>Bulls and Cows</title>
    <script src="scripts/underscore.js"></script>
</head>

<body>
    <input type="text" id="text-input-auto" autofocus="autofocus" placeholder="Type your guess here..." />
    <div id="output"></div>
    <script>
        /**
         * Create a simple number guessing game (bulls and cows).
         * When the game ends save the player nickname inside the localStorage.
         * Implement a high-score list
         */
        (function () {
            'use strict';

            var SIZE = 4,
                digits = "123456789",
                secret = _.sample(digits, SIZE),
                nGuesses = 0,
                outputDiv = document.getElementById('output'),
                p = document.createElement('div');

            window.addEventListener("load", main, false);

            function main() {
                print('Guess a number with ' + SIZE + ' unique digits from 1 through 9:');
                print('*bulls - digits in the right place');
                print('*cows - correct digits, but in the wrong place');

                var inputText = document.getElementById('text-input-auto');
                inputText.addEventListener('change', onGuess, false);
            }

            function onGuess() {
                var guess = _.uniq(this.value);
                console.log(_.difference(guess, digits.split('')));
                if (guess.length !== SIZE || _.difference(guess, digits.split('')).length) {
                    print('Malformed guess; try again.');
                    return;
                }
                var bulls = 0,
                    cows = 0;
                for (var i = 0; i < SIZE; i++) {
                    if (guess[i] === secret[i])++bulls
                    else if (_.contains(secret, guess[i]))++cows
                }
                if (bulls === SIZE) print('A winner is you!');
                else print(this.value + ': ' + bulls + ' bull(s), ' + cows + ' cow(s).');
            }

            function print(text) {
                var pClone = p.cloneNode(true);
                pClone.innerHTML = text;
                outputDiv.appendChild(pClone);
            }

        }());
    </script>
</body>

</html>
